# EVM DAO Governance Frontend

A modern web interface for the EVM DAO Governance system, built with SvelteKit and integrating with Ethereum wallets via SIWE (Sign-In with Ethereum).

## Features

### 🗳️ Proposal Management

-   **View Proposals**: Browse all DAO proposals with filtering and status indicators
-   **Create Proposals**: Submit three types of proposals:
    -   **Motion Proposals**: Text-based governance decisions
    -   **Ethereum Transactions**: Execute transactions on Ethereum networks
    -   **ICP Calls**: Execute canister method calls on Internet Computer

### 🔐 Wallet Integration

-   **MetaMask Support**: Connect with MetaMask and compatible wallets
-   **SIWE Authentication**: Cryptographic proof of Ethereum address ownership
-   **Multi-Network**: Support for Mainnet, Testnets, and local networks

### 📊 Voting Interface

-   **Secure Voting**: Cast votes with cryptographic verification
-   **Real-time Results**: View voting tallies and percentages
-   **Vote Tracking**: See your voting history and choices

### 🎨 Modern UI/UX

-   **Responsive Design**: Works on desktop and mobile devices
-   **Dark/Light Themes**: CSS custom properties for easy theming
-   **Interactive Components**: Real-time updates and smooth transitions

## Technology Stack

-   **Framework**: SvelteKit with TypeScript
-   **Styling**: SCSS with CSS custom properties
-   **Ethereum**: ethers.js v6 for wallet integration
-   **Authentication**: SIWE (Sign-In with Ethereum)
-   **IC Integration**: @dfinity packages for canister communication

## Quick Start

### Prerequisites

-   Node.js 18+ and npm
-   A running dfx local network
-   MetaMask or compatible Ethereum wallet

### Installation

1. **Install dependencies**:

    ```bash
    npm install
    ```

2. **Generate canister bindings**:

    ```bash
    dfx generate
    ```

3. **Start development server**:
    ```bash
    npm run start
    ```

The frontend will be available at `http://localhost:3000`.

### Build for Production

```bash
npm run build
```

## Project Structure

```
src/
├── lib/
│   ├── components/           # Reusable Svelte components
│   │   ├── WalletConnector.svelte    # Wallet connection UI
│   │   ├── ProposalForm.svelte       # Create new proposals
│   │   ├── ProposalList.svelte       # Browse proposals
│   │   ├── ProposalDetail.svelte     # View proposal details
│   │   └── VotingInterface.svelte    # Vote on proposals
│   ├── stores/               # Svelte stores for state management
│   │   └── auth.js          # Authentication state
│   ├── canisters.js         # IC canister integration
│   ├── ethereum.js          # Ethereum wallet functions
│   └── utils.js             # Utility functions
├── routes/                  # SvelteKit routes
│   ├── +page.svelte        # Home page
│   └── proposal/           # Proposal detail pages
└── index.scss              # Global styles
```

## Key Components

### WalletConnector

Handles wallet connection, disconnection, and network switching. Shows connection status and user address.

```svelte
<WalletConnector showNetworkInfo={true} />
```

### ProposalForm

Interactive form for creating new proposals with support for:

-   Motion proposals (text-based)
-   Ethereum transactions (with ERC20 helper)
-   ICP canister calls

```svelte
<ProposalForm on:proposalCreated={handleProposalCreated} />
```

### ProposalList

Displays paginated list of proposals with filtering options:

-   Filter by status (active, executed, expired, etc.)
-   Real-time voting tallies
-   Links to detailed views

```svelte
<ProposalList />
```

### VotingInterface

Secure voting interface with:

-   SIWE-based authentication
-   Three voting options (Yes, No, Abstain)
-   Vote verification and submission

```svelte
<VotingInterface {proposal} on:voteSubmitted={handleVote} />
```

## Configuration

### Network Settings

Update network configurations in `src/lib/utils.js`:

```javascript
export const NETWORKS = {
    1: { name: "Ethereum Mainnet", rpc: "...", explorer: "..." },
    31337: {
        name: "Anvil Local",
        rpc: "http://127.0.0.1:8545",
        explorer: "...",
    },
    // Add more networks as needed
};
```

### Canister IDs

Canister IDs are automatically generated by dfx. Ensure your local network is running:

```bash
dfx start --clean
dfx deploy
```

## SIWE Integration

The frontend uses SIWE (Sign-In with Ethereum) for authentication:

1. **Message Creation**: Generates RFC-4361 compliant messages
2. **Signature**: Users sign messages with their Ethereum wallet
3. **Verification**: Backend verifies signatures before processing requests

### Example SIWE Flow

1. User connects wallet
2. Frontend generates SIWE message for action (create proposal, vote)
3. User signs message with wallet
4. Frontend submits signed message to IC canister
5. Canister verifies signature and processes request

## Development

### Available Scripts

-   `npm run start` - Start development server
-   `npm run build` - Build for production
-   `npm run format` - Format code with Prettier

### Adding New Features

1. **New Components**: Add to `src/lib/components/`
2. **State Management**: Use Svelte stores in `src/lib/stores/`
3. **Styling**: Follow existing CSS custom property patterns
4. **IC Integration**: Update `src/lib/canisters.js` for new canister methods

### Styling Guidelines

The frontend uses a design system with CSS custom properties:

```scss
:root {
    --color-primary: #007bff;
    --color-success: #28a745;
    --color-danger: #dc3545;
    --spacing-md: 1rem;
    --border-radius-md: 8px;
}
```

## Security Considerations

1. **SIWE Verification**: All user actions require cryptographic proof
2. **Input Validation**: Form inputs are validated client and server-side
3. **Error Handling**: Graceful error handling with user feedback
4. **Network Safety**: Clear network indicators to prevent wrong-network transactions

## Troubleshooting

### Common Issues

**Wallet Connection Fails**

-   Ensure MetaMask is installed and unlocked
-   Check that you're on the correct network
-   Try refreshing the page

**Canister Calls Fail**

-   Verify dfx is running: `dfx ping local`
-   Check canister deployment: `dfx canister status --all`
-   Regenerate bindings: `dfx generate`

**SIWE Verification Fails**

-   Check wallet is connected
-   Ensure correct network (chain ID)
-   Verify message format matches expected structure

### Debug Mode

Enable debug logging by setting localStorage:

```javascript
localStorage.setItem("debug", "true");
```

## Contributing

1. Follow existing code style and patterns
2. Add TypeScript types for new functions
3. Include error handling for all async operations
4. Test with multiple wallet providers
5. Ensure responsive design on mobile devices

## License

This project is part of the EVM DAO Governance system. See the main repository for license information.
